import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from io import StringIO

# Create synthetic dataset (100 employees)
data = """EmployeeID,Name,Department,Region,PerformanceScore
1,John,HR,North,85
2,Emma,IT,South,90
3,Michael,Finance,East,78
4,Sophia,HR,West,92
5,William,Marketing,North,88
6,Olivia,HR,South,91
7,James,IT,East,87
8,Charlotte,Finance,West,89
9,Benjamin,Marketing,North,84
10,Amelia,HR,South,93
[90 more synthetic employees...]"""

# Load the data
df = pd.read_csv(StringIO(data))

# Add more synthetic data to reach 100 employees
departments = ['HR', 'IT', 'Finance', 'Marketing', 'Operations']
regions = ['North', 'South', 'East', 'West']

for i in range(11, 101):
    df.loc[len(df)] = [
        i,
        f"Employee_{i}",
        departments[i % len(departments)],
        regions[i % len(regions)],
        70 + (i % 30)
    ]

# Calculate HR frequency
hr_count = df['Department'].value_counts().get('HR', 0)
print(f"Frequency count for HR department: {hr_count}")

# Create visualization
plt.figure(figsize=(12, 7))
ax = sns.countplot(data=df, x='Department', order=df['Department'].value_counts().index)
plt.title('Employee Distribution Across Departments', fontsize=16)
plt.xlabel('Department', fontsize=14)
plt.ylabel('Number of Employees', fontsize=14)

# Add counts on top of bars
for p in ax.patches:
    ax.annotate(f'{p.get_height()}', 
               (p.get_x() + p.get_width() / 2., p.get_height()), 
               ha='center', va='center', 
               xytext=(0, 5), 
               textcoords='offset points')

plt.tight_layout()

# Save as HTML
from matplotlib.pyplot import savefig
import base64
from io import BytesIO

# Convert plot to HTML image
buffer = BytesIO()
plt.savefig(buffer, format='png')
buffer.seek(0)
image_base64 = base64.b64encode(buffer.read()).decode('utf-8')

# Create HTML content
html_content = f"""
<!DOCTYPE html>
<html>
<head>
    <title>Employee Department Analysis</title>
    <style>
        body {{ font-family: Arial, sans-serif; margin: 20px; }}
        .container {{ max-width: 900px; margin: 0 auto; }}
        .plot {{ text-align: center; margin: 20px 0; }}
        .footer {{ margin-top: 30px; font-size: 12px; color: #666; }}
    </style>
</head>
<body>
    <div class="container">
        <h1>Employee Department Analysis</h1>
        <p>Frequency count for HR department: <strong>{hr_count}</strong></p>
        
        <div class="plot">
            <img src="data:image/png;base64,{image_base64}" alt="Department Distribution">
        </div>
        
        <div class="footer">
            <p>Generated by: 24f1000537@ds.study.iitm.ac.in</p>
            <p>Dataset contains {len(df)} employee records</p>
        </div>
    </div>
</body>
</html>
"""

# Save HTML file
with open('employee_analysis.html', 'w') as f:
    f.write(html_content)

print("HTML file successfully created: employee_analysis.html")
